---
title: "assignment_3"
output: html_document
---

```{r setup, include=FALSE}
library(dplyr)
require(ggplot2)
library(caret)
library(rpgm)

meter_data <- read.csv2("smart_meter_data.csv")
survey_data <- read.csv2("survey_with_smart_meter_data.csv")
```

---
Exercise 1
---
```{r setup, include=FALSE}
joined_data <- inner_join(survey_data, meter_data, by = c("ID" = "V1"))

# Lowest Consumption
joined_data <- mutate(joined_data, lowest_consumption = rowMins(meter_data[, c(2:337)]))

# Highest Consumption
joined_data <- mutate(joined_data, highest_consumption = rowMaxs(meter_data[, c(2:337)]))

# Mean Consumption
joined_data <- mutate(joined_data, mean_consumption = rowMeans(meter_data[, c(2:337)]))

# Cumulated Consumption
joined_data <- mutate(joined_data, sum_consumption = rowSums(meter_data[, c(2:337)]))

# Night to noon ratio

# Morning Consumption

# Evening Consumption

# Weekend Consumption

# Lunch(preparation)time Consumption (11:00 - 13:00)  Sinnvoll?
lunchtime1 <- seq(from = 22, to = 337, by = 48)
lunchtime2 <- seq(from = 23, to = 337, by = 48)
lunchtime3 <- seq(from = 24, to = 337, by = 48)
lunchtime4 <- seq(from = 25, to = 337, by = 48)
lunchtime <- sort(c(lunchtime1, lunchtime2, lunchtime3, lunchtime4))

joined_data <- mutate(joined_data, lunchtime_consumption = rowMeans(meter_data[, lunchtime]))

# Dinner(preparation)time Consumption (17:00 - 19:00) Sinnvoll?


```

---
Exercise 2
---
```{r setup, include=FALSE}
# Split data set randomly into training set and test set
training_data_size <- floor(0.8 * nrow(joined_data))

set.seed(4815)

training_indices <- sample(seq_len(nrow(joined_data)), size = training_data_size)
training_data <- joined_data[training_indices,]
test_data <- joined_data[-training_indices,]

# Train the model
model <- glm(single ~ lowest_consumption + highest_consumption + mean_consumption + sum_consumption + lunchtime_consumption, family = binomial, data = training_data)

prediction <- predict(model, test_data[1,], type = "response")
confusionMatrix(data = as.numeric(prediction>0.5), reference = test_data$single)


```

---
Exercise 3
---