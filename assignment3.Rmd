---
title: "assignment_3"
output: html_document
---

```{r setup, include=FALSE}
library(dplyr)
require(ggplot2)
library(rpgm)

meter_data <- read.csv2("smart_meter_data.csv")
survey_data <- read.csv2("survey_with_smart_meter_data.csv")
```

---
Exercise 1
---
```{r setup, include=FALSE}
joined_data <- inner_join(survey_data, meter_data, by = c("ID" = "V1"))

# find null values
sapply(joined_data,function(x) sum(is.na(x)))

# Lowest Consumption
joined_data <- mutate(joined_data, lowest_consumption = rowMins(meter_data[, c(2:337)]))

# Highest Consumption
joined_data <- mutate(joined_data, highest_consumption = rowMaxs(meter_data[, c(2:337)]))

# Mean Consumption
joined_data <- mutate(joined_data, mean_consumption = rowMeans(meter_data[, c(2:337)]))

# Cumulated Consumption
joined_data <- mutate(joined_data, sum_consumption = rowSums(meter_data[, c(2:337)]))

# Night to noon ratio 23 - 0 vs 12 - 13
noon <- c()
for(i in c(0:1)) {
  data <- seq(from = 24 + i, to = 337, by = 48)
  noon <- sort(c(noon, data))
}
night <- c()
for(i in c(0:1)) {
  data <- seq(from = 46 + i, to = 337, by = 48)
  night <- sort(c(night, data))
}
joined_data <- mutate(joined_data, night_noon_consumption = rowMeans(meter_data[, night]) / rowMeans(meter_data[, noon]))

# Morning Consumption
morning <- c()
for(i in c(0:9)) {
  data <- seq(from = 14 + i, to = 337, by = 48)
  morning <- sort(c(morning, data))
}
joined_data <- mutate(joined_data, morning_consumption = rowMeans(meter_data[, morning]))

# Evening Consumption
evening <- c()
for(i in c(0:11)) {
  data <- seq(from = 36 + i, to = 337, by = 48)
  evening <- sort(c(evening, data))
}
joined_data <- mutate(joined_data, evening_consumption = rowMeans(meter_data[, evening]))

# Weekend Consumption

# Lunch(preparation)time Consumption (12:00 - 14:00)
lunchtime <- c()
for(i in c(0:3)) {
  data <- seq(from = 24 + i, to = 337, by = 48)
  lunchtime <- sort(c(lunchtime, data))
}

joined_data <- mutate(joined_data, lunchtime_consumption = rowMeans(meter_data[, lunchtime]))

# Dinner(preparation)time Consumption (18:00 - 20:00)
dinnertime <- c()
for(i in c(0:3)) {
  data <- seq(from = 36 + i, to = 337, by = 48)
  dinnertime <- sort(c(dinnertime, data))
}

joined_data <- mutate(joined_data, dinnerime_consumption = rowMeans(meter_data[, dinnertime]))

```

---
Exercise 2
---
```{r setup, include=FALSE}
# Split data set randomly into training set and test set
training_data_size <- floor(0.8 * nrow(joined_data))

set.seed(4815)

training_indices <- sample(seq_len(nrow(joined_data)), size = training_data_size)
training_data <- joined_data[training_indices,]
test_data <- joined_data[-training_indices,]

# Train the model
model <- glm(single ~ night_noon_consumption + highest_consumption + mean_consumption + dinnerime_consumption, family = binomial, data = training_data)

prediction <- predict(model, test_data[1,], type = "response")
confusionMatrix(data = as.numeric(prediction>0.5), reference = test_data$single)


```

---
Exercise 3
---